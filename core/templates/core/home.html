{% extends 'core/base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
    <h1>Welcome to My Awesome Social App!</h1>

    {% if user.is_authenticated %}
        <div class="post-form">
            <h2>Share something new:</h2>
            <form method="post" action="{% url 'create_post' %}">
                {% csrf_token %}
                <textarea name="content" placeholder="What's on your mind?" required></textarea>
                <button type="submit">Post</button>
            </form>
        </div>

        <div class="posts-list">
            <h2>Recent Posts:</h2>
            {% if posts %}
                {% for post in posts %}
                    <div class="post-card">
                        <h3><a href="{% url 'profile' post.user.username %}">{{ post.user.username }}</a></h3>
                        <p>{{ post.content }}</p>
                        <small>{{ post.created_at|date:"M d, Y H:i" }}</small>
                        <div class="post-actions">
                            <a href="{% url 'post_detail' post.id %}">View Post</a>
                            {% if user in post.likes.all %}
                                <form method="post" action="{% url 'unlike_post' post.id %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit">Unlike ({{ post.like_set.count }})</button>
                                </form>
                            {% else %}
                                <form method="post" action="{% url 'like_post' post.id %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit">Like ({{ post.like_set.count }})</button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>No posts yet! Be the first to share something.</p>
            {% endif %}
        </div>
    {% else %}
        <p>Please <a href="{% url 'login' %}">login</a> or <a href="{% url 'signup' %}">sign up</a> to join the fun!</p>
    {% endif %}
{% endblock %}
